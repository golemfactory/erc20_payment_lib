name: Distribute tests

on:
  push:
  workflow_dispatch:
  schedule:
    - cron: "42 3 * * *"

jobs:
  test_deposit:
    name: Test Distribute
    timeout-minutes: 20

    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Cache dependencies
        uses: Swatinem/rust-cache@v2
        with:
          shared-key: "dev-build-cache"

      - name: Build
        run: |
          cargo build
          cp target/debug/erc20_processor /usr/local/bin/erc20_processor
          [ $(which erc20_processor) == "/usr/local/bin/erc20_processor" ]

      - name: Distribute ETH
        run: |
          echo ${{ secrets.HOLESKY_FUND_ENV }} > .env
          cat .env
          erc20_processor distribute --amounts "0.0001;0.0001;0.0001;0.0001" --recipients "0x5b984629E2Cc7570cBa7dD745b83c3dD23Ba6d0f;0x5b984629E2Cc7570cBa7dD745b83c3dD23Ba6d0f;0x5b984629E2Cc7570cBa7dD745b83c3dD23Ba6d0f;0x5b984629E2Cc7570cBa7dD745b83c3dD23Ba6d0f"
          erc20_processor run
