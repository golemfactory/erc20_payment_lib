var se=Object.defineProperty;var re=(t,s,n)=>s in t?se(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var B=(t,s,n)=>(re(t,typeof s!="symbol"?s+"":s,n),n);import{r as o,j as e,R as b}from"./react-077fff36.js";import{c as oe}from"./react-dom-a94e3221.js";import{L as E,B as ae}from"./react-router-dom-aacee83d.js";import{D as I,I as le}from"./luxon-4a3d1a6a.js";import{d as ie,e as G,f as y}from"./react-router-cec35629.js";import{J as H}from"./react-json-tree-59dcb848.js";import{T as V,a as _,b as F,c as O}from"./react-tabs-866748e4.js";import{c as Q}from"./react-confirm-box-2b8c3243.js";import"./color-8be6040b.js";import"./color-string-327061cf.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-d8bc59f1.js";import"./is-arrayish-4445f582.js";import"./scheduler-765c72db.js";import"./@remix-run-671dfa1a.js";import"./@babel-90fae8f7.js";import"./react-base16-styling-9e0156d9.js";import"./base16-823cae66.js";import"./lodash.curry-9cd0b063.js";import"./clsx-1229b3e0.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const k=o.createContext({backendSettings:{backendUrl:"",bearerToken:"",enableBearerToken:!1},setBackendSettings:t=>{console.error(`setBackendSettings not implemented: ${t}`)},resetSettings:()=>{console.error("resetSettings not implemented")}}),ce=t=>{const s=window.localStorage.getItem("backendUrl")??"/api",n=window.localStorage.getItem("bearerToken")??"",i=window.localStorage.getItem("bearerTokenEnabled")==="1",r={backendUrl:s,bearerToken:n,enableBearerToken:i},[a,l]=o.useState(r),h=o.useCallback(u=>{window.localStorage.setItem("backendUrl",u.backendUrl),window.localStorage.setItem("bearerToken",u.bearerToken),window.localStorage.setItem("bearerTokenEnabled",u.enableBearerToken?"1":"0"),l(u)},[l]),d=o.useCallback(()=>{h({backendUrl:"/api",bearerToken:"",enableBearerToken:!1})},[h]);return e.jsx(k.Provider,{value:{backendSettings:a,setBackendSettings:h,resetSettings:d},children:t.children})};function C(t,s,n){const i=(n==null?void 0:n.headers)??new Headers,r=(n==null?void 0:n.method)??"GET",a=n==null?void 0:n.body;let l=s;if(s.startsWith("/"))t.backendUrl.endsWith("/")?l=t.backendUrl+s.substring(1):l=t.backendUrl+s;else throw new Error("Uri must start with /");return t.enableBearerToken&&i.append("Authorization","Bearer "+t.bearerToken),a&&i.append("Content-Type","application/json"),console.log("Calling backend: "+l),fetch(l,{method:r,headers:i,body:a})}class S{constructor(s,n,i){B(this,"config");B(this,"progress");B(this,"error");this.config=s,this.progress=n,this.error=i}}const X=o.createContext(new S(null,"",null)),Y=()=>o.useContext(X);function de(){const t=Y();if(t.config==null)throw new Error("Config not available");return t.config}const he=t=>{const[s,n]=o.useState(new S(null,"",null)),{backendSettings:i}=o.useContext(k);return o.useEffect(()=>{(async()=>{const r=i.backendUrl+"/config";n(new S(null,`Connecting to ${r}`,null));let a=null;try{const l=await C(i,"/config");if(l.type==="opaque"){n(new S(null,"",`Failed to connect to ${r} due to CORS policy`));return}a=await l.text();const h=JSON.parse(a);if(!h.config){n(new S(null,"",`No config field found on endpoint ${r} `));return}n(new S(h.config,"",null))}catch(l){console.log("Error fetching config",l),a&&console.log("Response body: ",a),n(new S(null,"",`Failed to connect to ${r}`))}})()},[n,i]),e.jsx(X.Provider,{value:s,children:t.children})};const J=()=>{const{backendSettings:t,setBackendSettings:s,resetSettings:n}=o.useContext(k),[i,r]=b.useState(t.backendUrl),a=p=>{r(p.target.value)},[l,h]=b.useState(t.bearerToken),[d,u]=b.useState(t.enableBearerToken),x=p=>{u(p.target.checked)},f=p=>{h(p.target.value)},m=()=>{s({backendUrl:i,bearerToken:l,enableBearerToken:d})},j=()=>{r(t.backendUrl),h(t.bearerToken),u(t.enableBearerToken)};o.useEffect(()=>{r(t.backendUrl),h(t.bearerToken),u(t.enableBearerToken)},[t]);const w=()=>{n()},v=()=>i!==t.backendUrl||l!==t.bearerToken||d!==t.enableBearerToken;return e.jsxs("div",{className:"backend-settings",children:[e.jsx("div",{children:"Backend settings"}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend URL:"}),e.jsx("input",{type:"text",value:i,onChange:a}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend security:"}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bearer authentication"})," - token is added to bearer header value."]}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:d,onChange:x}),"Enabled"]})}),e.jsx("input",{type:"text",value:l,onChange:f,disabled:!d}),e.jsx("hr",{}),e.jsxs("div",{className:"box-line",children:[e.jsx("input",{type:"button",value:"Save",onClick:m,disabled:!v()}),e.jsx("input",{type:"button",value:"Cancel",onClick:j,disabled:!v()}),e.jsx("input",{type:"button",value:"Reset to default",onClick:w})]})]})};const Z=t=>{const s=I.now(),n=t.date,i=t.title,r="N/A",a="-";let l="Date not yet available";function h(d,u,x,f){return t.minimal?e.jsx("div",{title:f,className:"date-container",children:e.jsx("div",{className:"date-container-date",children:u})}):e.jsxs("div",{title:f,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:d}),e.jsx("div",{className:"date-container-date",children:u}),e.jsx("div",{className:"date-container-msg",children:x})]})}if(n==null)return h(i,r,a,l);try{const d=I.fromISO(n),u=I.now(),x=le.fromDateTimes(d,s);let f;x.length("days")>3?f=Math.floor(x.length("days"))+" days ago":x.length("hours")>3?f=Math.floor(x.length("hours"))+" hours ago":x.length("minutes")>3?f=Math.floor(x.length("minutes"))+" min. ago":f=Math.floor(x.length("seconds"))+" sec. ago";let m=d.toFormat("yyyy-LL-dd HH:mm:ss");return d.toFormat("yyyy-LL-dd")===u.toFormat("yyyy-LL-dd")&&(m=d.toFormat("HH:mm:ss")),l="Iso date: "+d.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),h(i,m,f,l)}catch(d){return h(i,"error",`${d}`,`${d}`)}},ue=t=>{var n;const s=t.latestCall;return e.jsxs("div",{className:"call-box",children:[e.jsx("div",{className:"call-box-header",children:e.jsx("a",{href:`/frontend/call/${t.endpointKey}/${s.id}`,children:s.id})}),e.jsx(Z,{date:s.date,title:"Time",minimal:!0}),e.jsx("div",{className:"call-box-body",children:s.parsedRequest.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.parsedRequest[0].method??"unknown"}),e.jsxs(e.Fragment,{children:[((n=s.parsedRequest[0].parsedCall)==null?void 0:n.to)&&e.jsxs("div",{children:[e.jsx("div",{children:"Contract :"}),e.jsx("div",{children:s.parsedRequest[0].parsedCall.to})]}),s.parsedRequest[0].parsedCall&&e.jsxs("div",{children:[e.jsx("div",{children:"ERC20 balance:"}),e.jsx("div",{children:s.parsedRequest[0].parsedCall.address})]})]})]}):e.jsx("div",{children:"unknown"})})]})},xe=t=>{var l;const[s,n]=b.useState(null),{backendSettings:i}=o.useContext(k),r=o.useCallback(async()=>{try{const d=await(await C(i,`/calls/${t.apikey}/${t.showAtOnce}`)).json();n(d)}catch(h){console.log(h),n(null)}},[t.refreshToken]);function a(h){return e.jsx(ue,{endpointKey:t.apikey,latestCall:h},h.id)}return o.useEffect(()=>{r().then()},[r]),s===null?e.jsxs("div",{className:"latest-calls-box",children:[e.jsx("div",{children:e.jsx("h3",{children:t.apikey})}),"Loading...",e.jsx("hr",{})]}):s.error?e.jsxs("div",{className:"latest-calls-box",children:[e.jsx("div",{children:e.jsx("h3",{children:t.apikey})}),s.error,e.jsx("hr",{})]}):e.jsxs("div",{className:"latest-calls-box",children:[e.jsx("div",{children:e.jsx("h3",{children:t.apikey})}),(l=s==null?void 0:s.calls)==null?void 0:l.map(a),e.jsx("hr",{})]})},me=()=>{const[t,s]=o.useState(0),{backendSettings:n}=o.useContext(k),[i,r]=o.useState([]),[a,l]=o.useState([]),[h,d]=o.useState(""),[u,x]=o.useState("10"),f=o.useCallback(async()=>{try{let j=[];h.length>0&&(j=h.split(",").map(g=>g.trim()),j=j.filter(g=>g.length>0));let p=(await(await C(n,"/keys/active")).json()).keys.splice(0).sort();l(p),j.length>0&&(p=j.filter(g=>p.indexOf(g)>=0)),r(p)}catch(j){console.log(j),r([])}},[h,r]);b.useEffect(()=>{console.log("Refreshing dashboard..."),f().then(()=>{setTimeout(()=>{s(t+1)},2e3)})},[s,t]);function m(j){return e.jsx(xe,{apikey:j,refreshToken:t,showAtOnce:parseInt(u)||10},j)}return e.jsxs("div",{children:[e.jsxs("div",{className:"monitor-filter",children:[e.jsxs("div",{className:"monitor-filter-row1",children:[e.jsx("div",{className:"monitor-filter-el1",children:"Columns from server:"}),e.jsx("div",{children:a.join(",")})]}),e.jsxs("div",{className:"monitor-filter-row2",children:[e.jsx("div",{className:"monitor-filter-el1",children:"Selected columns:"}),e.jsx("input",{className:"monitor-filter-row2-el2",type:"text",value:h,onChange:j=>d(j.target.value)})]}),e.jsxs("div",{className:"monitor-filter-row3",children:[e.jsx("div",{className:"monitor-filter-el1",children:"Last displayed calls:"}),e.jsx("input",{className:"monitor-filter-row3-el2",type:"text",value:u,onChange:j=>x(j.target.value)})]})]}),e.jsx("div",{className:"monitor-appkey-lister",children:i.map(m)})]})};const W={scheme:"default",author:"chris kempson (http://chriskempson.com)",base00:"#181818",base01:"#282828",base02:"#383838",base03:"#585858",base04:"#b8b8b8",base05:"#d8d8d8",base06:"#e8e8e8",base07:"#f8f8f8",base08:"#ab4642",base09:"#dc9656",base0A:"#f7ca88",base0B:"#a1b56c",base0C:"#86c1b9",base0D:"#7cafc2",base0E:"#ba8baf",base0F:"#a16946"},K=()=>{const t=ie(),{backendSettings:s}=o.useContext(k),[n,i]=o.useState(null),r=t.callNo?parseInt(t.callNo):-1,[a,l]=o.useState(r),h=o.useCallback(async()=>{try{const j=await(await C(s,`/call/${t.key}/${a}`)).json();i(j.call)}catch(m){console.log(m),i(null)}},[t,a]);o.useEffect(()=>{h().then()},[h]);let d=null;try{d=n!=null&&n.request?JSON.parse(n==null?void 0:n.request):null}catch(m){console.log(m)}let u=null;try{u=n!=null&&n.response?JSON.parse(n==null?void 0:n.response):null}catch(m){console.log(m)}if(a<0)return e.jsx("div",{className:"single-call-info",children:e.jsx("h3",{children:"Call no is not specified"})});const x=(m,j,w)=>!0;function f(m){l(m),window.history.replaceState(null,"",`/frontend/call/${t.key}/${m}`)}return e.jsxs("div",{className:"single-call-info",children:[e.jsx("button",{style:{margin:"0 0.5rem 0.5rem 0"},disabled:a==0,onClick:()=>f(a-1),children:"Previous call"}),e.jsx("button",{onClick:()=>f(a+1),children:"Next call"}),e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Web3 endpoint key"}),e.jsx("td",{children:t.key})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Call no"}),e.jsx("td",{children:n==null?void 0:n.id})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Call time"}),e.jsx("td",{children:e.jsx(Z,{date:n==null?void 0:n.date,title:"Call time",minimal:!1})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Response time"}),e.jsx("td",{children:n==null?void 0:n.responseTime})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{children:"Request"}),e.jsxs(V,{children:[e.jsxs(_,{children:[e.jsx(F,{children:"JSON"}),e.jsx(F,{children:"Raw"})]}),e.jsx(O,{children:d&&e.jsx(H,{shouldExpandNodeInitially:x,theme:W,invertTheme:!0,data:d})}),e.jsx(O,{children:e.jsx("code",{children:n==null?void 0:n.request})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Response"}),e.jsxs(V,{children:[e.jsxs(_,{children:[e.jsx(F,{children:"JSON"}),e.jsx(F,{children:"Raw"})]}),e.jsx(O,{selected:!1,children:u&&e.jsx(H,{shouldExpandNodeInitially:x,theme:W,invertTheme:!0,data:u})}),e.jsx(O,{selected:!0,children:e.jsx("code",{children:n==null?void 0:n.response})})]})]})]})};const je=t=>{b.useEffect(()=>{console.log("Refreshing dashboard...")},[t]);const[s,n]=o.useState(null),{backendSettings:i}=o.useContext(k),[r,a]=o.useState(""),[l,h]=o.useState(""),[d,u]=o.useState(""),[x,f]=o.useState(""),[m,j]=o.useState(""),[w,v]=o.useState(""),[p,g]=o.useState(""),[L,$]=o.useState(""),[q,U]=o.useState(""),[A,P]=o.useState(""),[T,R]=o.useState(0),D=o.useCallback(async()=>{try{const N=await(await C(i,`/problems/${t.apikey}`)).json();n(N.problems),a(N.problems.errorChance.toString()),h(N.problems.timeoutChance.toString()),u(N.problems.malformedResponseChance.toString()),f(N.problems.skipSendingRawTransactionChance.toString()),j(N.problems.sendTransactionButReportFailureChance.toString())}catch(c){console.log(c),n(null)}},[n,T]);b.useEffect(()=>{D().then(()=>{})},[D]),b.useEffect(()=>{const c=parseFloat(r);isNaN(c)?v("Not a number"):c>=0&&c<=1?v(""):v("Has to be number between 0.0 and 1.0")},[r]),b.useEffect(()=>{const c=parseFloat(l);isNaN(c)?g("Not a number"):c>=0&&c<=1?g(""):g("Has to be number between 0.0 and 1.0")},[l]),b.useEffect(()=>{const c=parseFloat(d);isNaN(c)?$("Not a number"):c>=0&&c<=1?$(""):$("Has to be number between 0.0 and 1.0")},[d]),b.useEffect(()=>{const c=parseFloat(x);isNaN(c)?U("Not a number"):c>=0&&c<=1?(console.log("Updating error chance to "+c),U("")):U("Has to be number between 0.0 and 1.0")},[x]),b.useEffect(()=>{const c=parseFloat(m);isNaN(c)?P("Not a number"):c>=0&&c<=1?(console.log("Updating error chance to "+c),P("")):P("Has to be number between 0.0 and 1.0")},[m]);const ne=o.useCallback(async()=>{if(s){console.log("Saving problems");const c={errorChance:parseFloat(r),timeoutChance:parseFloat(l),malformedResponseChance:parseFloat(d),skipSendingRawTransactionChance:parseFloat(x),sendTransactionButReportFailureChance:parseFloat(m),allowOnlyParsedCalls:s.allowOnlyParsedCalls,allowOnlySingleCalls:s.allowOnlySingleCalls};await C(i,`/problems/set/${t.apikey}`,{method:"POST",body:JSON.stringify(c)}),R(T+1)}},[s,T,R,r,l,d,x,m]),te=o.useCallback(async()=>{await Q("Are you sure you want to delete all endpoint history?")&&(await C(i,`/keys/delete/${t.apikey}`,{method:"POST"}),R(T+1))},[T,R,t]);if(s===null)return e.jsx("div",{className:"endpoint",children:e.jsx("div",{children:"loading..."})});let M=w!==""||p!==""||L!==""||q!==""||A!=="";return r===s.errorChance.toString()&&l===s.timeoutChance.toString()&&d===s.malformedResponseChance.toString()&&x===s.skipSendingRawTransactionChance.toString()&&m===s.sendTransactionButReportFailureChance.toString()&&(M=!0),e.jsxs("div",{className:"endpoint",children:[e.jsxs("div",{className:"endpoint-header-title",children:["Endpoint ",t.apikey]}),e.jsx("div",{children:JSON.stringify(s)}),e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Error chance per request"}),e.jsx("td",{children:e.jsx("input",{value:r,onChange:c=>a(c.target.value)})}),e.jsx("td",{children:s.errorChance}),e.jsx("td",{children:e.jsx("div",{children:w})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Timeout chance per request"}),e.jsx("td",{children:e.jsx("input",{value:l,onChange:c=>h(c.target.value)})}),e.jsx("td",{children:s.timeoutChance}),e.jsx("td",{children:e.jsx("div",{children:p})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Malformed response chance"}),e.jsx("td",{children:e.jsx("input",{value:d,onChange:c=>u(c.target.value)})}),e.jsx("td",{children:s.malformedResponseChance}),e.jsx("td",{children:e.jsx("div",{children:L})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Skip sending chance"}),e.jsx("td",{children:e.jsx("input",{value:x,onChange:c=>f(c.target.value)})}),e.jsx("td",{children:s.skipSendingRawTransactionChance}),e.jsx("td",{children:e.jsx("div",{children:q})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Send but report error chance"}),e.jsx("td",{children:e.jsx("input",{value:m,onChange:c=>j(c.target.value)})}),e.jsx("td",{children:s.sendTransactionButReportFailureChance}),e.jsx("td",{children:e.jsx("div",{children:A})})]})]})}),e.jsx("button",{onClick:()=>te(),children:"Delete"}),e.jsx("button",{disabled:M,onClick:()=>ne(),children:"Save"})]})},fe=()=>{const[t,s]=o.useState([]),[n,i]=o.useState(0),{backendSettings:r}=o.useContext(k),a=o.useCallback(async()=>{try{const x=await(await C(r,"/keys")).json();s(x.keys)}catch(u){console.log(u),s([])}},[s]);b.useEffect(()=>{console.log("Refreshing dashboard..."),a().then(()=>{})},[a,n]);const l=o.useCallback(async()=>{await Q("Are you sure you want to delete all endpoints history?")&&(await C(r,"/keys/delete_all",{method:"POST"}),i(n+1))},[n,i]),h=o.useCallback(async()=>{i(n+1),s([])},[n,i]);function d(u){return e.jsx(je,{apikey:u},u)}return e.jsxs("div",{className:"endpoints",children:[e.jsxs("div",{className:"endpoints-header",children:[e.jsx("button",{onClick:()=>h(),children:"Refresh"}),e.jsx("button",{onClick:()=>l(),children:"Delete All Endpoints"})]}),t.map(d)]})};const pe=()=>{const{backendSettings:t}=o.useContext(k),s=de();return e.jsxs("div",{className:"welcome-page",children:[e.jsx("h1",{children:"Web3 proxy"}),e.jsxs("p",{children:["Connected to the endpoint ",t.backendUrl]}),e.jsxs("p",{children:["Frontend version ","0.1.1"]}),e.jsxs("p",{children:["Backend version ",s.version]})]})},be=()=>{const t=Y();return t.error?e.jsxs("div",{children:[e.jsx("div",{children:t.error}),e.jsx(J,{})]}):t.config==null?e.jsxs("div",{children:["Loading... ",t.progress]}):e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"top-header",children:[e.jsx("div",{className:"top-header-title",children:"Web3 proxy panel"}),e.jsxs("div",{className:"top-header-navigation",children:[e.jsx(E,{to:"/",children:"Main"}),e.jsx(E,{to:"/monitor",children:"Monitor"}),e.jsx(E,{to:"/endpoints",children:"Endpoints"}),e.jsx(E,{to:"/page3",children:"Page 3"})]})]}),e.jsx("div",{className:"main-content",children:e.jsxs(G,{children:[e.jsx(y,{path:"/",element:e.jsx(pe,{})}),e.jsx(y,{path:"monitor",element:e.jsx("div",{children:e.jsx(me,{})})}),e.jsx(y,{path:"/call/:key/:callNo",element:e.jsx(K,{})}),e.jsx(y,{path:"call",element:e.jsx("div",{children:e.jsx(K,{})})}),e.jsx(y,{path:"endpoints",element:e.jsx("div",{children:e.jsx(fe,{})})}),e.jsx(y,{path:"page3",element:e.jsx("div",{children:e.jsx(J,{})})})]})})]})})},ee=document.getElementById("root");if(!ee)throw new Error("No root element found");const z=oe.createRoot(ee),ge=document.baseURI;ge.includes("/frontend/")?z.render(e.jsx(b.StrictMode,{children:e.jsx(ce,{children:e.jsx(he,{children:e.jsx(ae,{basename:"/frontend/",children:e.jsx(G,{children:e.jsx(y,{path:"/*",element:e.jsx(be,{})})})})})})})):z.render(e.jsx("div",{children:e.jsxs("p",{children:["Invalid base URI, navigate to ","/frontend/"]})}));
