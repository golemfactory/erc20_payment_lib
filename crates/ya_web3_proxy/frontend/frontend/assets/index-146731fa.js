var Z=Object.defineProperty;var ee=(t,s,n)=>s in t?Z(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var E=(t,s,n)=>(ee(t,typeof s!="symbol"?s+"":s,n),n);import{r,j as e,R as p}from"./react-c2eccb4a.js";import{c as ne}from"./react-dom-ae9f5c52.js";import{L as B,B as te}from"./react-router-dom-7943c7e0.js";import{D as U,I as se}from"./luxon-91c18b66.js";import{d as oe,e as V,f as v}from"./react-router-89dba378.js";import{J as q}from"./react-json-tree-3bb10570.js";import{T as A,a as D,b as O,c as $}from"./react-tabs-701526c6.js";import{c as W}from"./react-confirm-box-9fe3216c.js";import"./color-308a626c.js";import"./color-string-80575a37.js";import"./color-name-b7949e8c.js";import"./simple-swizzle-43abd917.js";import"./is-arrayish-4445f582.js";import"./scheduler-04ce0582.js";import"./@remix-run-35d41228.js";import"./@babel-85587bd4.js";import"./react-base16-styling-9aa39d3a.js";import"./base16-823cae66.js";import"./lodash.curry-920c78a7.js";import"./clsx-1229b3e0.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const C=r.createContext({backendSettings:{backendUrl:"",bearerToken:"",enableBearerToken:!1},setBackendSettings:t=>{console.error(`setBackendSettings not implemented: ${t}`)},resetSettings:()=>{console.error("resetSettings not implemented")}}),re=t=>{const s=window.localStorage.getItem("backendUrl")??"/api",n=window.localStorage.getItem("bearerToken")??"",i=window.localStorage.getItem("bearerTokenEnabled")==="1",o={backendUrl:s,bearerToken:n,enableBearerToken:i},[a,l]=r.useState(o),d=r.useCallback(h=>{window.localStorage.setItem("backendUrl",h.backendUrl),window.localStorage.setItem("bearerToken",h.bearerToken),window.localStorage.setItem("bearerTokenEnabled",h.enableBearerToken?"1":"0"),l(h)},[l]),c=r.useCallback(()=>{d({backendUrl:"/api",bearerToken:"",enableBearerToken:!1})},[d]);return e.jsx(C.Provider,{value:{backendSettings:a,setBackendSettings:d,resetSettings:c},children:t.children})};function k(t,s,n){const i=(n==null?void 0:n.headers)??new Headers,o=(n==null?void 0:n.method)??"GET",a=n==null?void 0:n.body;let l=s;if(s.startsWith("/"))t.backendUrl.endsWith("/")?l=t.backendUrl+s.substring(1):l=t.backendUrl+s;else throw new Error("Uri must start with /");return t.enableBearerToken&&i.append("Authorization","Bearer "+t.bearerToken),a&&i.append("Content-Type","application/json"),console.log("Calling backend: "+l),fetch(l,{method:o,headers:i,body:a})}class S{constructor(s,n,i){E(this,"config");E(this,"progress");E(this,"error");this.config=s,this.progress=n,this.error=i}}const K=r.createContext(new S(null,"",null)),z=()=>r.useContext(K);function ae(){const t=z();if(t.config==null)throw new Error("Config not available");return t.config}const le=t=>{const[s,n]=r.useState(new S(null,"",null)),{backendSettings:i}=r.useContext(C);return r.useEffect(()=>{(async()=>{const o=i.backendUrl+"/config";n(new S(null,`Connecting to ${o}`,null));let a=null;try{const l=await k(i,"/config");if(l.type==="opaque"){n(new S(null,"",`Failed to connect to ${o} due to CORS policy`));return}a=await l.text();const d=JSON.parse(a);if(!d.config){n(new S(null,"",`No config field found on endpoint ${o} `));return}n(new S(d.config,"",null))}catch(l){console.log("Error fetching config",l),a&&console.log("Response body: ",a),n(new S(null,"",`Failed to connect to ${o}`))}})()},[n,i]),e.jsx(K.Provider,{value:s,children:t.children})};const M=()=>{const{backendSettings:t,setBackendSettings:s,resetSettings:n}=r.useContext(C),[i,o]=p.useState(t.backendUrl),a=b=>{o(b.target.value)},[l,d]=p.useState(t.bearerToken),[c,h]=p.useState(t.enableBearerToken),x=b=>{h(b.target.checked)},f=b=>{d(b.target.value)},j=()=>{s({backendUrl:i,bearerToken:l,enableBearerToken:c})},m=()=>{o(t.backendUrl),d(t.bearerToken),h(t.enableBearerToken)};r.useEffect(()=>{o(t.backendUrl),d(t.bearerToken),h(t.enableBearerToken)},[t]);const w=()=>{n()},y=()=>i!==t.backendUrl||l!==t.bearerToken||c!==t.enableBearerToken;return e.jsxs("div",{className:"backend-settings",children:[e.jsx("div",{children:"Backend settings"}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend URL:"}),e.jsx("input",{type:"text",value:i,onChange:a}),e.jsx("hr",{}),e.jsx("h3",{children:"Backend security:"}),e.jsxs("p",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"Bearer authentication"})," - token is added to bearer header value."]}),e.jsx("div",{children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:c,onChange:x}),"Enabled"]})}),e.jsx("input",{type:"text",value:l,onChange:f,disabled:!c}),e.jsx("hr",{}),e.jsxs("div",{className:"box-line",children:[e.jsx("input",{type:"button",value:"Save",onClick:j,disabled:!y()}),e.jsx("input",{type:"button",value:"Cancel",onClick:m,disabled:!y()}),e.jsx("input",{type:"button",value:"Reset to default",onClick:w})]})]})};const G=t=>{const s=U.now(),n=t.date,i=t.title,o="N/A",a="-";let l="Date not yet available";function d(c,h,x,f){return t.minimal?e.jsx("div",{title:f,className:"date-container",children:e.jsx("div",{className:"date-container-date",children:h})}):e.jsxs("div",{title:f,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:c}),e.jsx("div",{className:"date-container-date",children:h}),e.jsx("div",{className:"date-container-msg",children:x})]})}if(n==null)return d(i,o,a,l);try{const c=U.fromISO(n),h=U.now(),x=se.fromDateTimes(c,s);let f;x.length("days")>3?f=Math.floor(x.length("days"))+" days ago":x.length("hours")>3?f=Math.floor(x.length("hours"))+" hours ago":x.length("minutes")>3?f=Math.floor(x.length("minutes"))+" min. ago":f=Math.floor(x.length("seconds"))+" sec. ago";let j=c.toFormat("yyyy-LL-dd HH:mm:ss");return c.toFormat("yyyy-LL-dd")===h.toFormat("yyyy-LL-dd")&&(j=c.toFormat("HH:mm:ss")),l="Iso date: "+c.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),d(i,j,f,l)}catch(c){return d(i,"error",`${c}`,`${c}`)}},ie=t=>{var n;const s=t.latestCall;return e.jsxs("div",{className:"call-box",children:[e.jsx("div",{className:"call-box-header",children:e.jsx("a",{href:`/frontend/call/${t.endpointKey}/${s.id}`,children:s.id})}),e.jsx(G,{date:s.date,title:"Time",minimal:!0}),e.jsx("div",{className:"call-box-body",children:s.parsedRequest.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:s.parsedRequest[0].method??"unknown"}),e.jsxs(e.Fragment,{children:[((n=s.parsedRequest[0].parsedCall)==null?void 0:n.to)&&e.jsxs("div",{children:[e.jsx("div",{children:"Contract :"}),e.jsx("div",{children:s.parsedRequest[0].parsedCall.to})]}),s.parsedRequest[0].parsedCall&&e.jsxs("div",{children:[e.jsx("div",{children:"ERC20 balance:"}),e.jsx("div",{children:s.parsedRequest[0].parsedCall.address})]})]})]}):e.jsx("div",{children:"unknown"})})]})},ce=t=>{var l;const[s,n]=p.useState(null),{backendSettings:i}=r.useContext(C),o=r.useCallback(async()=>{try{const c=await(await k(i,`/calls/${t.apikey}/${t.showAtOnce}`)).json();n(c)}catch(d){console.log(d),n(null)}},[t.refreshToken]);function a(d){return e.jsx(ie,{endpointKey:t.apikey,latestCall:d},d.id)}return r.useEffect(()=>{o().then()},[o]),s===null?e.jsxs("div",{className:"latest-calls-box",children:[e.jsx("div",{children:e.jsx("h3",{children:t.apikey})}),"Loading...",e.jsx("hr",{})]}):s.error?e.jsxs("div",{className:"latest-calls-box",children:[e.jsx("div",{children:e.jsx("h3",{children:t.apikey})}),s.error,e.jsx("hr",{})]}):e.jsxs("div",{className:"latest-calls-box",children:[e.jsx("div",{children:e.jsx("h3",{children:t.apikey})}),(l=s==null?void 0:s.calls)==null?void 0:l.map(a),e.jsx("hr",{})]})},de=()=>{const[t,s]=r.useState(0),{backendSettings:n}=r.useContext(C),[i,o]=r.useState([]),[a,l]=r.useState([]),[d,c]=r.useState(""),[h,x]=r.useState("10"),f=r.useCallback(async()=>{try{let m=[];d.length>0&&(m=d.split(",").map(g=>g.trim()),m=m.filter(g=>g.length>0));let b=(await(await k(n,"/keys/active")).json()).keys.splice(0).sort();l(b),m.length>0&&(b=m.filter(g=>b.indexOf(g)>=0)),o(b)}catch(m){console.log(m),o([])}},[d,o]);p.useEffect(()=>{console.log("Refreshing dashboard..."),f().then(()=>{setTimeout(()=>{s(t+1)},2e3)})},[s,t]);function j(m){return e.jsx(ce,{apikey:m,refreshToken:t,showAtOnce:parseInt(h)||10},m)}return e.jsxs("div",{children:[e.jsxs("div",{className:"monitor-filter",children:[e.jsxs("div",{className:"monitor-filter-row1",children:[e.jsx("div",{className:"monitor-filter-el1",children:"Columns from server:"}),e.jsx("div",{children:a.join(",")})]}),e.jsxs("div",{className:"monitor-filter-row2",children:[e.jsx("div",{className:"monitor-filter-el1",children:"Selected columns:"}),e.jsx("input",{className:"monitor-filter-row2-el2",type:"text",value:d,onChange:m=>c(m.target.value)})]}),e.jsxs("div",{className:"monitor-filter-row3",children:[e.jsx("div",{className:"monitor-filter-el1",children:"Last displayed calls:"}),e.jsx("input",{className:"monitor-filter-row3-el2",type:"text",value:h,onChange:m=>x(m.target.value)})]})]}),e.jsx("div",{className:"monitor-appkey-lister",children:i.map(j)})]})};const H={scheme:"default",author:"chris kempson (http://chriskempson.com)",base00:"#181818",base01:"#282828",base02:"#383838",base03:"#585858",base04:"#b8b8b8",base05:"#d8d8d8",base06:"#e8e8e8",base07:"#f8f8f8",base08:"#ab4642",base09:"#dc9656",base0A:"#f7ca88",base0B:"#a1b56c",base0C:"#86c1b9",base0D:"#7cafc2",base0E:"#ba8baf",base0F:"#a16946"},_=()=>{const t=oe(),{backendSettings:s}=r.useContext(C),[n,i]=r.useState(null),o=t.callNo?parseInt(t.callNo):-1,[a,l]=r.useState(o),d=r.useCallback(async()=>{try{const m=await(await k(s,`/call/${t.key}/${a}`)).json();i(m.call)}catch(j){console.log(j),i(null)}},[t,a]);r.useEffect(()=>{d().then()},[d]);let c=null;try{c=n!=null&&n.request?JSON.parse(n==null?void 0:n.request):null}catch(j){console.log(j)}let h=null;try{h=n!=null&&n.response?JSON.parse(n==null?void 0:n.response):null}catch(j){console.log(j)}if(a<0)return e.jsx("div",{className:"single-call-info",children:e.jsx("h3",{children:"Call no is not specified"})});const x=(j,m,w)=>!0;function f(j){l(j),window.history.replaceState(null,"",`/frontend/call/${t.key}/${j}`)}return e.jsxs("div",{className:"single-call-info",children:[e.jsx("button",{style:{margin:"0 0.5rem 0.5rem 0"},disabled:a==0,onClick:()=>f(a-1),children:"Previous call"}),e.jsx("button",{onClick:()=>f(a+1),children:"Next call"}),e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Web3 endpoint key"}),e.jsx("td",{children:t.key})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Call no"}),e.jsx("td",{children:n==null?void 0:n.id})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Call time"}),e.jsx("td",{children:e.jsx(G,{date:n==null?void 0:n.date,title:"Call time",minimal:!1})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Response time"}),e.jsx("td",{children:n==null?void 0:n.responseTime})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{children:"Request"}),e.jsxs(A,{children:[e.jsxs(D,{children:[e.jsx(O,{children:"JSON"}),e.jsx(O,{children:"Raw"})]}),e.jsx($,{children:c&&e.jsx(q,{shouldExpandNodeInitially:x,theme:H,invertTheme:!0,data:c})}),e.jsx($,{children:e.jsx("code",{children:n==null?void 0:n.request})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{children:"Response"}),e.jsxs(A,{children:[e.jsxs(D,{children:[e.jsx(O,{children:"JSON"}),e.jsx(O,{children:"Raw"})]}),e.jsx($,{selected:!1,children:h&&e.jsx(q,{shouldExpandNodeInitially:x,theme:H,invertTheme:!0,data:h})}),e.jsx($,{selected:!0,children:e.jsx("code",{children:n==null?void 0:n.response})})]})]})]})};const he=t=>{p.useEffect(()=>{console.log("Refreshing dashboard...")},[t]);const[s,n]=r.useState(null),{backendSettings:i}=r.useContext(C),[o,a]=r.useState(""),[l,d]=r.useState(""),[c,h]=r.useState(""),[x,f]=r.useState(""),[j,m]=r.useState(""),[w,y]=r.useState(""),[b,g]=r.useState(""),[F,P]=r.useState(""),[N,R]=r.useState(0),I=r.useCallback(async()=>{try{const T=await(await k(i,`/problems/${t.apikey}`)).json();n(T.problems),a(T.problems.errorChance.toString()),d(T.problems.timeoutChance.toString()),h(T.problems.malformedResponseChance.toString()),f(T.problems.skipSendingRawTransactionChance.toString())}catch(u){console.log(u),n(null)}},[n,N]);p.useEffect(()=>{I().then(()=>{})},[I]),p.useEffect(()=>{const u=parseFloat(o);isNaN(u)?m("Not a number"):u>=0&&u<=1?m(""):m("Has to be number between 0.0 and 1.0")},[o]),p.useEffect(()=>{const u=parseFloat(l);isNaN(u)?y("Not a number"):u>=0&&u<=1?y(""):y("Has to be number between 0.0 and 1.0")},[l]),p.useEffect(()=>{const u=parseFloat(c);isNaN(u)?g("Not a number"):u>=0&&u<=1?g(""):g("Has to be number between 0.0 and 1.0")},[c]),p.useEffect(()=>{const u=parseFloat(x);isNaN(u)?P("Not a number"):u>=0&&u<=1?(console.log("Updating error chance to "+u),P("")):P("Has to be number between 0.0 and 1.0")},[x]);const X=r.useCallback(async()=>{if(s){console.log("Saving problems");const u={errorChance:parseFloat(o),timeoutChance:parseFloat(l),malformedResponseChance:parseFloat(c),skipSendingRawTransactionChance:parseFloat(x),allowOnlyParsedCalls:s.allowOnlyParsedCalls,allowOnlySingleCalls:s.allowOnlySingleCalls};await k(i,`/problems/set/${t.apikey}`,{method:"POST",body:JSON.stringify(u)}),R(N+1)}},[s,N,R,o,l,c,x]),Y=r.useCallback(async()=>{await W("Are you sure you want to delete all endpoint history?")&&(await k(i,`/keys/delete/${t.apikey}`,{method:"POST"}),R(N+1))},[N,R,t]);if(s===null)return e.jsx("div",{className:"endpoint",children:e.jsx("div",{children:"loading..."})});let L=j!==""||w!==""||b!==""||F!=="";return o===s.errorChance.toString()&&l===s.timeoutChance.toString()&&c===s.malformedResponseChance.toString()&&x===s.skipSendingRawTransactionChance.toString()&&(L=!0),e.jsxs("div",{className:"endpoint",children:[e.jsxs("div",{className:"endpoint-header-title",children:["Endpoint ",t.apikey]}),e.jsx("div",{children:JSON.stringify(s)}),e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{children:"Error chance per request"}),e.jsx("td",{children:e.jsx("input",{value:o,onChange:u=>a(u.target.value)})}),e.jsx("td",{children:s.errorChance}),e.jsx("td",{children:e.jsx("div",{children:j})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Timeout chance per request"}),e.jsx("td",{children:e.jsx("input",{value:l,onChange:u=>d(u.target.value)})}),e.jsx("td",{children:s.timeoutChance}),e.jsx("td",{children:e.jsx("div",{children:w})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Malformed response chance"}),e.jsx("td",{children:e.jsx("input",{value:c,onChange:u=>h(u.target.value)})}),e.jsx("td",{children:s.malformedResponseChance}),e.jsx("td",{children:e.jsx("div",{children:b})})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Skip sending chance"}),e.jsx("td",{children:e.jsx("input",{value:x,onChange:u=>f(u.target.value)})}),e.jsx("td",{children:s.skipSendingRawTransactionChance}),e.jsx("td",{children:e.jsx("div",{children:F})})]})]})}),e.jsx("button",{onClick:()=>Y(),children:"Delete"}),e.jsx("button",{disabled:L,onClick:()=>X(),children:"Save"})]})},ue=()=>{const[t,s]=r.useState([]),[n,i]=r.useState(0),{backendSettings:o}=r.useContext(C),a=r.useCallback(async()=>{try{const x=await(await k(o,"/keys")).json();s(x.keys)}catch(h){console.log(h),s([])}},[s]);p.useEffect(()=>{console.log("Refreshing dashboard..."),a().then(()=>{})},[a,n]);const l=r.useCallback(async()=>{await W("Are you sure you want to delete all endpoints history?")&&(await k(o,"/keys/delete_all",{method:"POST"}),i(n+1))},[n,i]),d=r.useCallback(async()=>{i(n+1),s([])},[n,i]);function c(h){return e.jsx(he,{apikey:h},h)}return e.jsxs("div",{className:"endpoints",children:[e.jsxs("div",{className:"endpoints-header",children:[e.jsx("button",{onClick:()=>d(),children:"Refresh"}),e.jsx("button",{onClick:()=>l(),children:"Delete All Endpoints"})]}),t.map(c)]})};const xe=()=>{const{backendSettings:t}=r.useContext(C),s=ae();return e.jsxs("div",{className:"welcome-page",children:[e.jsx("h1",{children:"Web3 proxy"}),e.jsxs("p",{children:["Connected to the endpoint ",t.backendUrl]}),e.jsxs("p",{children:["Frontend version ","0.1.1"]}),e.jsxs("p",{children:["Backend version ",s.version]})]})},me=()=>{const t=z();return t.error?e.jsxs("div",{children:[e.jsx("div",{children:t.error}),e.jsx(M,{})]}):t.config==null?e.jsxs("div",{children:["Loading... ",t.progress]}):e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"top-header",children:[e.jsx("div",{className:"top-header-title",children:"Web3 proxy panel"}),e.jsxs("div",{className:"top-header-navigation",children:[e.jsx(B,{to:"/",children:"Main"}),e.jsx(B,{to:"/monitor",children:"Monitor"}),e.jsx(B,{to:"/endpoints",children:"Endpoints"}),e.jsx(B,{to:"/page3",children:"Page 3"})]})]}),e.jsx("div",{className:"main-content",children:e.jsxs(V,{children:[e.jsx(v,{path:"/",element:e.jsx(xe,{})}),e.jsx(v,{path:"monitor",element:e.jsx("div",{children:e.jsx(de,{})})}),e.jsx(v,{path:"/call/:key/:callNo",element:e.jsx(_,{})}),e.jsx(v,{path:"call",element:e.jsx("div",{children:e.jsx(_,{})})}),e.jsx(v,{path:"endpoints",element:e.jsx("div",{children:e.jsx(ue,{})})}),e.jsx(v,{path:"page3",element:e.jsx("div",{children:e.jsx(M,{})})})]})})]})})},Q=document.getElementById("root");if(!Q)throw new Error("No root element found");const J=ne.createRoot(Q),je=document.baseURI;je.includes("/frontend/")?J.render(e.jsx(p.StrictMode,{children:e.jsx(re,{children:e.jsx(le,{children:e.jsx(te,{basename:"/frontend/",children:e.jsx(V,{children:e.jsx(v,{path:"/*",element:e.jsx(me,{})})})})})})})):J.render(e.jsx("div",{children:e.jsxs("p",{children:["Invalid base URI, navigate to ","/frontend/"]})}));
