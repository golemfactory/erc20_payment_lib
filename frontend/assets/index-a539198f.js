import{j as e,r as f,R as v}from"./react-5a14d1f0.js";import{c as U}from"./react-dom-8f0dfa0a.js";import{D as S,I as G}from"./luxon-91c18b66.js";import{F as _,G as J,B as L,a as q}from"./react-icons-1a5cf1b9.js";import{C as K}from"./react-loading-icons-8836a31d.js";import{L as A,B as X}from"./react-router-dom-c2931411.js";import{d as z,e as R,f as F}from"./react-router-b1e149b2.js";import"./scheduler-04ce0582.js";import"./@remix-run-963a0ed9.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();function E(n,s,t,c){return e.jsxs("div",{title:c,className:"date-container",children:[e.jsx("div",{className:"date-container-title",children:n}),e.jsx("div",{className:"date-container-date",children:s}),e.jsx("div",{className:"date-container-msg",children:t})]})}const k=n=>{const s=S.now(),t=n.date,c=n.title,a="N/A",r="-";let l="Date not yet available";if(t==null)return E(c,a,r,l);try{const d=S.fromISO(t),g=S.now(),o=G.fromDateTimes(d,s);let h;o.length("days")>3?h=Math.floor(o.length("days"))+" days ago":o.length("hours")>3?h=Math.floor(o.length("hours"))+" hours ago":o.length("minutes")>3?h=Math.floor(o.length("minutes"))+" min. ago":h=Math.floor(o.length("seconds"))+" sec. ago";let j=d.toFormat("yyyy-LL-dd HH:mm:ss");return d.toFormat("yyyy-LL-dd")===g.toFormat("yyyy-LL-dd")&&(j=d.toFormat("HH:mm:ss")),l="Iso date: "+d.toUTC().toFormat("yyyy-LL-dd HH:mm:ss"),E(c,j,h,l)}catch(d){return E(c,"error",`${d}`,`${d}`)}};let m="";const Q="/erc20/frontend/";function V(n){m=n}const O=f.createContext(null),P=()=>f.useContext(O),D=()=>{const n=P();if(n==null||typeof n=="string")throw new Error("Config not available");return n},W=n=>{const[s,t]=f.useState(null);return f.useEffect(()=>{(async()=>{t(`Connecting to ${m}`);try{const a=await(await fetch(`${m}/config`)).json();t(a.config)}catch{t(`Failed to connect to ${m}`)}})()},[t]),e.jsx(O.Provider,{value:s,children:n.children})};const I=n=>{const s=D(),t=typeof n.chainId=="string"?parseInt(n.chainId):n.chainId,c=s.chainSetup[t];if(!c)return e.jsxs("span",{children:["No ",t," in config"]});let a=n.contractAddress,r=`contract id: ${n.contractAddress}`;return n.isAddress&&(r=`address id: ${n.contractAddress}`),n.isAddress==="Receiver id"&&(r=`Receiver id: ${n.contractAddress}`),c.multiContractAddress===n.contractAddress&&(a="Multi payment contract"),c.glmAddress===n.contractAddress&&(a=`${c.currencyGlmSymbol} token`),e.jsx("a",{href:c.blockExplorerUrl,title:r,children:e.jsxs("div",{className:"contract-details-contract",children:[e.jsx(_,{className:"contract-details-contract-icon"}),e.jsx("div",{className:"contract-details-contract-name",children:a})]})})};function C(n){return typeof n=="string"&&(n=BigInt(n)),n=n/BigInt("1000000000000000000"),n.toString()}const Z=n=>{const s=n.transfer;return e.jsxs("div",{className:"transfer-box",children:[e.jsx("div",{className:"transfer-id",title:"Transfer db id",children:s.id}),e.jsx("div",{className:"transfer-receiver",title:"Receiver address",children:e.jsx(I,{contractAddress:s.receiverAddr,chainId:s.chainId,isAddress:"Receiver id"})}),e.jsxs("div",{className:"transfer-token",title:"Tokens transferred",children:[C(s.tokenAmount)," ",n.tokenSymbol]})]})},Y=n=>{const[s,t]=f.useState(null),c=D();if(v.useEffect(()=>{console.log("Loading transfers for tx "+n.tx_id),(async()=>{if(n.tx_id){const b=await(await fetch(`${m}/transfers/${n.tx_id}`)).json();t(b)}})().then(()=>{console.log("Loaded transfers for tx "+n.tx_id)})},[n.tx_id]),s===null)return e.jsx("div",{children:"Loading..."});const a=s.transfers.length??0;let r=BigInt(0);const l=new Set;for(let u=0;u<a;u++)r+=BigInt(s.transfers[u].tokenAmount),l.add(s.transfers[u].receiverAddr);const d=r.toString();if(a===0)return e.jsxs("div",{className:"transfers-box",children:[e.jsx("div",{className:"transfers-box-header",children:"No transfers related to this transactions"}),e.jsx("div",{className:"transfers-box-content"})]});const g=s.transfers[0].tokenAddr,o=s.transfers[0].chainId,h=typeof o=="string"?parseInt(o):o;let j="???";g==null?j=c.chainSetup[h].currencyGasSymbol:c.chainSetup[h].glmAddress===g&&(j=c.chainSetup[h].currencyGlmSymbol);const i=C(d),x=(u,N)=>e.jsx(Z,{transfer:u,tokenSymbol:j},N);return e.jsxs("div",{className:"transfers-box",children:[e.jsxs("div",{className:"transfers-box-header",children:[a," transfers to ",l.size," distinct addresses for a sum of ",i," ",j,":"," "]}),e.jsx("div",{className:"transfers-box-content",children:s.transfers.map(x)})]})};const H=n=>{const s=D(),t=typeof n.chainId=="string"?parseInt(n.chainId):n.chainId;if(t==null)return e.jsx("div",{children:"Unknown chain"});const c=s.chainSetup[t];return c?e.jsx("a",{href:c.blockExplorerUrl,title:`chain id: ${n.chainId}`,children:e.jsxs("div",{className:"chain-details-chain",children:[e.jsx(_,{className:"chain-details-chain-icon"}),e.jsx("div",{className:"chain-details-chain-name",children:c.chainName})]})}):e.jsxs("span",{children:["No ",t," in config"]})};const ee=n=>{const s=D(),t=typeof n.chainId=="string"?parseInt(n.chainId):n.chainId,c=s.chainSetup[t];return c?e.jsx("a",{href:c.blockExplorerUrl,title:`Transaction hash: ${n.transactionHash}`,children:e.jsxs("div",{className:"transaction-details-transaction",children:[e.jsx(_,{className:"transaction-details-transaction-icon"}),e.jsx("div",{className:"transaction-details-transaction-name",children:n.transactionHash})]})}):e.jsxs("span",{children:["No ",t," in config"]})},ne=n=>{const s=n.tx;if(s==null)return e.jsx("div",{className:"tx-container-wrapper"});let t=null;s.feePaid&&(t=C(s.feePaid));function c(){fetch(`${m}/tx/skip/${n.tx_id}`,{method:"POST"}).then(l=>{console.log(l)})}function a(){return s.confirmDate!=null&&s.error==null&&s.engineError==null?e.jsx(J,{className:"tx-ok-icon"}):s.engineError!=null?e.jsx(L,{className:"tx-error-icon"}):s.error!=null?e.jsx(L,{className:"tx-error-icon"}):s.engineMessage?e.jsx(K,{className:"tx-loading",fill:"#000000"}):e.jsx(q,{className:"tx-wait-icon"})}function r(){return s.engineMessage?e.jsx("button",{onClick:c,children:"Skip transaction"}):e.jsx(e.Fragment,{})}return e.jsxs("div",{className:"tx-container-wrapper",children:[e.jsx("div",{className:"tx-container-header"}),e.jsxs("div",{className:"tx-container",children:[e.jsxs("div",{className:"tx-id",children:["db id: ",s.id]}),e.jsx("div",{className:"chain-id",children:e.jsx(H,{chainId:s.chainId})}),e.jsx("div",{className:"tx-method",title:"method",children:s.method}),e.jsx("div",{className:"tx-created",children:e.jsx(k,{title:"queued",date:s.createdDate})}),e.jsx("div",{className:"tx-from",children:e.jsx(I,{isAddress:!0,chainId:s.chainId,contractAddress:s.fromAddr})}),e.jsx("div",{className:"tx-from-descr",children:"From"}),e.jsx("div",{className:"tx-to",children:e.jsx(I,{isAddress:!1,chainId:s.chainId,contractAddress:s.toAddr})}),e.jsx("div",{className:"tx-to-descr",children:"To"}),e.jsx("div",{className:"tx-broadcast",children:e.jsx(k,{title:"broadcast",date:s.broadcastDate})}),e.jsx("div",{className:"tx-confirmed",children:e.jsx(k,{title:"confirmed",date:s.confirmDate})}),s.txHash?e.jsxs("div",{className:"tx-hash",children:[e.jsx("span",{}),e.jsx(ee,{chainId:s.chainId,transactionHash:s.txHash})]}):e.jsx("div",{className:"tx-hash tx-hash-unknown",children:"Tx hash - not available"}),s.nonce?e.jsxs("div",{className:"tx-nonce",children:["nonce: ",s.nonce]}):e.jsx("div",{className:"tx-nonce tx-nonce-unknown",children:"nonce: N/A"}),s.gasLimit?e.jsxs("div",{className:"tx-gas-limit",children:["gas limit: ",s.gasLimit]}):e.jsx("div",{className:"tx-gas-limit tx-gas-limit-unknown",children:"gas limit: N/A"}),s.feePaid?e.jsxs("div",{className:"tx-fee",children:["fee paid: ",t]}):e.jsx("div",{className:"tx-fee tx-fee-unknown",children:"fee paid: N/A"}),e.jsx("div",{className:"tx-processing",children:a()}),e.jsxs("div",{className:"tx-message",children:[r(),s.engineMessage," ",e.jsxs("span",{className:"tx-message-error",children:[s.engineError," ",s.error]})]})]}),e.jsx("div",{className:"tx-transfers",children:e.jsx(Y,{tx_id:s.id})})]})},T=10,se=()=>{const[n,s]=v.useState(0),[t,c]=v.useState(null),a=f.useCallback(i=>{i!=null?(i.length>=T&&(i[T-1].opacity=0,i[T-1].maxHeight=0),c(i.slice(0,T))):c(i)},[]),[r,l]=v.useState(null),d=f.useCallback(async()=>{const x=await(await fetch(`${m}/transactions/count`)).json();l(x)},[]),g=f.useCallback(async()=>{const u=(await(await fetch(`${m}/transactions/feed/5/2`)).json()).txs.slice().reverse().map(N=>({data:N}));if(t==null){a(u);return}else{const N=t.slice(),b=[];for(const w of u){const y=w.data;let $=-1;for(let p=0;p<t.length;p++)if(t[p].data.id===y.id){$=p;break}$===-1?(w.opacity=0,w.maxHeight=0,b.push(w)):N[$].data=y}if(b.length>0){const w=[...b,...N];a(w),await new Promise(y=>setTimeout(y,100));for(const y of w)y.opacity=1,y.maxHeight=500;a(w.slice())}}},[t,a]),o=f.useCallback(async()=>{const i=g(),x=d();await Promise.all([i,x]),await new Promise(u=>setTimeout(u,5e3))},[g,d]);v.useEffect(()=>{console.log("Refreshing dashboard..."),o().then(()=>{s(n+1)})},[o,n]);const h=i=>{const x=i.opacity??1,u=i.maxHeight??200;return e.jsx("div",{style:{opacity:x,maxHeight:u},className:"tx-wrapper",children:e.jsx(ne,{tx_id:i.data.id,tx:i.data})},i.data.id)};let j=0;if(t)for(const i of t)(i.opacity===void 0||i.opacity>0)&&j++;return e.jsxs("div",{children:[e.jsx("h3",{children:"Transaction feed"}),e.jsxs("div",{children:["Displaying ",j," transactions out of ",r==null?void 0:r.txDone," finished transaction and"," ",r==null?void 0:r.txQueued," queued"]}),t!=null?e.jsx("div",{className:"tx-33",children:t.map(h)}):e.jsx("div",{children:"Loading..."})]})};const B=n=>{if(n.allowance==null)return e.jsx("div",{children:"Unknown allowance"});const s=BigInt(n.allowance.allowance),t=BigInt("0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"),c=C(n.allowance.allowance),a=s>t?"Unlimited":c;return e.jsx("div",{className:"allowance-box",children:e.jsxs("div",{className:"allowance-box-body",children:[e.jsxs("div",{className:"allowance-id",children:["Allowance no ",n.allowance.id]}),e.jsx("div",{className:"allowance-owner",children:e.jsx(I,{isAddress:!0,chainId:n.allowance.chainId,contractAddress:n.allowance.owner})}),e.jsx("div",{className:"allowance-owner-descr",children:e.jsx("span",{children:"Owner/Account"})}),e.jsx("div",{className:"allowance-chain-id",children:e.jsx(H,{chainId:n.allowance.chainId})}),e.jsx("div",{className:"allowance-confirm-date",children:e.jsx(k,{date:n.allowance.confirmDate,title:"Confirmed Date"})}),e.jsxs("div",{className:"allowance-tx-id",children:["txid: ",n.allowance.txId]}),e.jsx("div",{className:"allowance-spender",children:e.jsx(I,{isAddress:!1,chainId:n.allowance.chainId,contractAddress:n.allowance.spender})}),e.jsx("div",{className:"allowance-spender-descr",children:e.jsx("span",{children:"Spender"})}),e.jsx("div",{className:"allowance-token-addr",children:e.jsx(I,{isAddress:!1,chainId:n.allowance.chainId,contractAddress:n.allowance.tokenAddr})}),e.jsx("div",{className:"allowance-allowance",title:c,children:e.jsxs("span",{children:["Spending allowed: ",a]})})]})})},te=n=>{const[s,t]=v.useState(null),c=f.useCallback(async()=>{const l=await(await fetch(`${m}/account/${n.account}`)).json();t(l)},[n.account]);v.useEffect(()=>{c().then()},[c]);function a(r,l){return e.jsx("div",{children:e.jsx(B,{allowance:r})},l)}return s===null?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"account-box",children:[e.jsxs("div",{className:"account-box-header",children:["Account ",n.account]}),e.jsxs("div",{className:"account-box-body",children:[e.jsx("div",{children:JSON.stringify(s)}),e.jsx("div",{children:s.allowances.map(a)})]})]})},ae=()=>{const[n,s]=v.useState(null),t=f.useCallback(async()=>{const r=await(await fetch(`${m}/accounts`)).json();s(r)},[]);function c(a,r){return e.jsx(te,{account:a},r)}return f.useEffect(()=>{t().then()},[t]),e.jsxs("div",{children:[e.jsx("h1",{children:"Accounts"}),n==null?void 0:n.publicAddr.map(c),JSON.stringify(n)]})},ce=()=>{const n={allowance:"115792089237316195423570985008687907853269984665640564039457584007913129639935",chainId:987789,confirmDate:"2022-12-23T13:37:47.827436700Z",error:null,feePaid:null,id:9,owner:"0x001066290077e38f222cc6009c0c7a91d5192303",spender:"0xbcfe9736a4f5bf2e43620061ff3001ea0d003c0f",tokenAddr:"0xec9f23c207018a444f9351df3d7937f609870667",txId:null},s={allowance:"12200000000000000000",chainId:987789,confirmDate:null,error:null,feePaid:null,id:10,owner:"0x101066290077e28f222cc6009c0c7a91d5192303",spender:"0xbcfe9736a4f5bf2e43620061ff3001ea0d003c0f",tokenAddr:"0xef9f23c207018a444f9351df3d7937f609870667",txId:null};return e.jsx("div",{children:e.jsxs("div",{className:"padding",children:[e.jsx("h1",{children:"Allowance box design time"}),e.jsx(B,{allowance:n}),e.jsx(B,{allowance:s})]})})},re=()=>{const[n,s]=v.useState(null),t=f.useCallback(async()=>{const r=await(await fetch(`${m}/allowances`)).json();s(r)},[]);function c(a,r){return e.jsx(B,{allowance:a},r)}return f.useEffect(()=>{t().then()},[t]),e.jsxs("div",{children:[e.jsx("h1",{children:"Allowances"}),n==null?void 0:n.allowances.map(c),JSON.stringify(n)]})},ie=n=>{let s="Unknown entry";return n.event.transferIn!==null?s="Transfer in":n.event.chainTransfer!==null&&(s="Chain transfer"),e.jsx("div",{children:e.jsxs("span",{children:[s," ",n.event.date.toJSDate().toISOString()," ",n.event.transferred.toString()," - balance:"," ",n.event.balance.toString()]})})},oe=()=>{const{account:n}=z(),[s,t]=v.useState(null),c=f.useCallback(async()=>{const l=await(await fetch(`${m}/account/${n}/in`)).json(),d=l.chainTransfers,g=l.transfersIn,o=[];for(const i of d){const x={id:`chain_transfer_${i.id}`,date:S.fromISO(i.blockchainDate),chainTransfer:i,transferIn:null,transferred:BigInt(i.tokenAmount),balance:BigInt(0)};o.push(x)}for(const i of g){const x={id:`transfer_in_${i.id}`,date:S.fromISO(i.requestedDate),chainTransfer:null,transferIn:i,transferred:-BigInt(i.tokenAmount),balance:BigInt(0)};o.push(x)}o.sort((i,x)=>i.date.toMillis()-x.date.toMillis());const h=o.find(i=>i.transferIn!=null);if(h!=null){const i=o.indexOf(h);o.splice(0,i)}let j=BigInt(0);for(const i of o)j+=i.transferred,i.balance=j;o.reverse(),t(o)},[n,t]);v.useEffect(()=>{c().then()},[c]);function a(r){return e.jsx(ie,{event:r},r.id)}return s===null?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{children:[e.jsx("h1",{children:"Balance"}),s.map(a)]})},le=()=>{const n=P();return n==null?e.jsx("div",{children:"Loading..."}):typeof n=="string"?e.jsx("div",{children:n}):e.jsx("div",{children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"top-header",children:[e.jsx("div",{className:"top-header-title",children:"Erc20 Payments Driver Dashboard"}),e.jsxs("div",{className:"top-header-navigation",children:[e.jsx(A,{to:"/",children:"Main"}),e.jsx(A,{to:"/feed",children:"Transaction feed"}),e.jsx(A,{to:"/accounts",children:"Accounts"}),e.jsx(A,{to:"/allowances",children:"Allowances"}),e.jsx(A,{to:"/balance/0x0000000600000006000000060000000600000006",children:"Balance"})]})]}),e.jsx("div",{className:"main-content",children:e.jsxs(R,{children:[e.jsx(F,{path:"/",element:e.jsx("div",{children:e.jsx("div",{children:e.jsxs("div",{className:"padding",children:[e.jsxs("p",{children:["Connected to payment driver API url:"," ",e.jsx("a",{href:m,children:m})]}),e.jsx("textarea",{style:{width:800,height:500},readOnly:!0,value:JSON.stringify(n,null,2)})]})})})}),e.jsx(F,{path:"feed",element:e.jsx(se,{})}),e.jsx(F,{path:"accounts",element:e.jsx(ae,{})}),e.jsx(F,{path:"allowances",element:e.jsx(re,{})}),e.jsx(F,{path:"balance/:account",element:e.jsx(oe,{})}),e.jsx(F,{path:"design_allowance_box",element:e.jsx(ce,{})})]})})]}):"Connecting to API..."})},M=document.getElementById("root");if(!M)throw new Error("No root element found");const de=U.createRoot(M);fetch("/erc20/frontend/config.json").then(n=>{n.json().then(s=>{V(s.backendUrl),de.render(e.jsx(v.StrictMode,{children:e.jsx(W,{children:e.jsx(X,{basename:Q,children:e.jsx(R,{children:e.jsx(F,{path:"/*",element:e.jsx(le,{})})})})})}))})});
